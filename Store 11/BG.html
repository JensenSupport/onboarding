<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>BG Training | Store 11</title>
    <link rel="stylesheet" href="../shared-style.css">
    <style>
        .cred-box {
            width: 90%;
            max-width: 600px;
            background: #000;
            color: #fff;
            padding: 10px;
            margin-top: 10px;
            margin-bottom: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background 0.3s ease;
            cursor: pointer;
            display: inline-block;
        }
        .cred-box:hover {
            background: #222;
        }
        .cred-box small {
            display: block;
            margin-top: 5px;
            font-size: 12px;
            color: #ccc;
        }

        .instructions {
            margin-top: 15px;
        }
    </style>
</head>
<body>

<header>
     <a href="../Store%2011/manager.html">
      <img src="../logo.jpg" alt="Jensen Tire & Auto Logo">
    </a>
    <div id="hamburger" onclick="toggleMenu()">☰</div>
</header>

<nav id="nav-menu">
  <a href="../index.html">Main Dashboard</a>
  <a href="../Store%2011/manager.html">Manager Courses</a>
  <a href="#" onclick="openFeedbackPopup()">Submit Feedback</a>
  <a href="#" class="nav-link open-zammad-chat">Jensen Support chat</a>
  <a href="https://jensentireandauto.com/" target="_blank">Retail Site</a>
</nav>
    
<section id="role">
  <div class="container">
    <h1>BG Training - Store 11</h1>
    <p>Register using the additional email from "Noreply@BGprod.com".
    <br>
    <br>
    You have 24Hrs from when you receive the link to register.<br>
    If missed, please request an invite using the button below.
    <br>
    <br>
    </p>

  <div class="training-buttons">    
    <a class="button" href="https://go.team1bg.com" target="_blank">Launch BG Training</a>
  </div>
      
    <p class="instructions">
      <div class="training-buttons">    
        <a class="button" href="https://www.youtube.com/watch?v=N_ysr1ppa58" target="_blank">Point-of-Sale Video</a>
      </div>
    </p>

    <p class="instructions">
      <div class="training-buttons">    
        <a class="button" href="https://www.youtube.com/playlist?list=PLtiLcHwsO99shZwiZE5nyWOhJPPS084oD" target="_blank">Product Knowledge Playlist</a>
      </div>
    </p>

    <div class="training-buttons">    
        <a class="button" onclick="openRequest()">Request BG Invite</a>
    </div>

    <footer style="margin-top: 40px;">
        Questions? Contact <a href="mailto:support@jensentireandauto.com">Jensen Support</a>
    </footer>
  </div>
</section>

<div id="feedbackPopup" class="feedback-popup">
  <div class="feedback-content">
    <h3>We value your input!</h3>
    <form id="feedback-form">
      <textarea
        id="feedback"
        name="feedback"
        placeholder="Leave your feedback here..."
        required
      ></textarea>
      <br />
      <button type="submit" class="button">Submit</button>
      <button type="button" class="button" onclick="closeFeedbackPopup()">Cancel</button>
    </form>
    <p id="thank-you" style="display: none; color: black; margin-top: 20px;">Thank you for your feedback!</p>
  </div>
</div>

<div id="requestPopup" class="feedback-popup" style="display: none;">
  <div class="feedback-content">
    <h3 id="request-title">Request BG Invite</h3>
    <form id="request-form">
      <textarea
        id="request"
        name="request"
        placeholder="Please type your name and Email"
        required
      ></textarea>
      <br />
      <button type="submit" class="button">Submit</button>
      <button type="button" class="button" onclick="closeRequest()">Cancel</button>
    </form>
    <p id="thank-you-request" style="display: none; color: black; margin-top: 20px;">
      Thank you! Your request was sent. Please allow up to 24hrs for response.
    </p>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // ===== CONFIG =====
  const VENDOR_KEY = "bg"; // field in profiles.vendorCreds
  const firebaseConfig = {
    apiKey: "AIzaSyC3clH2uoqhgqeEwj-uOlsNT5XTZHsI2W0",
    authDomain: "user-creds.firebaseapp.com",
    projectId: "user-creds",
    appId: "1:253655292974:web:f066f853ef2f3dd7f5d3bf"
  };

  const app  = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db   = getFirestore(app);

  onAuthStateChanged(auth, async (user) => {
    if (!user) return;
    try {
      const emailId = (user.email || "").toLowerCase();
      const dirSnap = await getDoc(doc(db, "directory", emailId));
      if (!dirSnap.exists()) throw new Error("Profile missing");
      const creds = dirSnap.data().vendorCreds?.bg;

      const userBox = document.getElementById("bgUserBox");
      const passBox = document.getElementById("bgPassBox");
      const userText= document.getElementById("bgUserText");
      const passText= document.getElementById("bgPassText");

      if (!creds || !creds.username || !creds.password) {
        document.getElementById("noCreds").style.display = "block";
        userText.textContent = "—";
        passText.textContent = "—";
        userBox.style.pointerEvents = "none";
        passBox.style.pointerEvents = "none";
        return;
      }

      userText.textContent = creds.username;
      passText.textContent = creds.password;
      userBox.dataset.copy = creds.username;
      passBox.dataset.copy = creds.password;
    } catch (e) {
      console.error(e);
      document.getElementById("noCreds").style.display = "block";
    }
  });
</script>

<!-- Helpers (copied from Continental) -->
<script>
  function openFeedbackPopup(){ document.getElementById('feedbackPopup').style.display='block'; }
  function closeFeedbackPopup(){ document.getElementById('feedbackPopup').style.display='none'; }

  document.getElementById("feedback-form").addEventListener("submit", async function (e) {
    e.preventDefault();
    const feedback = document.getElementById("feedback").value;
    const response = await fetch("https://default4e006550b51242c29ec2b301c0fa6a.51.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/5a8c354b3a634ab893a5879f150f715d/triggers/manual/paths/invoke/?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=Jr-fRt0XwxxcfPUPvbpjS-xwfZlb2rjb4J_L2xwhXFg", {
      method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ feedback })
    });
    if (response.ok) {
      document.getElementById("feedback").value = "";
      document.getElementById("thank-you").style.display = "block";
      setTimeout(() => { document.getElementById("thank-you").style.display = "none"; closeFeedbackPopup(); }, 2000);
    } else { alert("Submission failed. Please try again."); }
  });

  function toggleMenu(){ document.getElementById("nav-menu").classList.toggle("open"); }
  function closeMenu(){ document.getElementById("nav-menu").classList.remove("open"); }
  document.addEventListener("click", function(e){
    const menu=document.getElementById("nav-menu"); const ham=document.getElementById("hamburger");
    if(menu.classList.contains("open") && !menu.contains(e.target) && !ham.contains(e.target)) closeMenu();
  });
  document.addEventListener("keydown", function(e){ if(e.key==="Escape") closeMenu(); });

  function copyToClipboard(text){
    navigator.clipboard.writeText(text).then(
      () => alert('Copied: ' + text),
      (err) => alert('Failed to copy: ' + err)
    );
  }
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://jensensupport.co/assets/chat/chat.min.js"></script>
<script>
  $(function() {
    const zammadChatInstance = new ZammadChat({
      title: 'Jensen Support', background: 'rgb(249, 117, 38)', fontSize: '12px', chatId: 1,
    });
    $('.open-zammad-chat').on('click', function(e){ e.preventDefault(); zammadChatInstance.show(); });
  });
</script>

<script>
  function openRequest() {
    document.getElementById('requestPopup').style.display = 'block';
  }

  function closeRequest() {
    document.getElementById('requestPopup').style.display = 'none';
  }

  // Attach once the DOM for #request-form exists (your scripts are at the bottom, so this is fine)
  document.getElementById("request-form").addEventListener("submit", async function (e) {
    e.preventDefault();

    const request = document.getElementById("request").value.trim();
    if (!request) return;

    try {
      const response = await fetch("https://default4e006550b51242c29ec2b301c0fa6a.51.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/f347dc9d785147bc8f7d93b4b6b85703/triggers/manual/paths/invoke/?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=RLNxDI6ddPzHBX2LKJaahp-v3cvvoBr5MMPx6WQ_izs", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        // IMPORTANT: send the value under the property name your Flow expects.
        // If your Flow is expecting "request", keep it as is. If it expects "feedback",
        // change the key to { feedback: request }.
        body: JSON.stringify({ request })
      });

      if (response.ok) {
        document.getElementById("request").value = "";
        document.getElementById("thank-you-request").style.display = "block";
        setTimeout(() => {
          document.getElementById("thank-you-request").style.display = "none";
          closeRequest();
        }, 3200);
      } else {
        alert("Submission failed. Please try again.");
      }
    } catch (err) {
      alert("Network error. Please try again.");
      console.error(err);
    }
  });
</script>

</body>
</html>
